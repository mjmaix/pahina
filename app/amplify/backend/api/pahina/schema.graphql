# NOTE:
#  generated mutation/queries does not exclude field specific auth
#  active: Boolean @auth(rules: [{ allow: groups, groups: ["Admin"] }])

enum PahinaNoteStatus {
  DRAFT
  PUBLISHED
  PUBLISHED_EDITED
  UNLISTED
}

enum PahinaPriceLevel {
  L_0
  L_50
  L_100
  L_150
  L_200
  L_250
  L_300
  L_350
  L_400
  L_450
  L_500
}

enum PahinaStoreProductStatus {
  SENT
  CREATING
  CREATED
  FAILED
}

type PahinaUser
  @model(subscriptions: null)
  @auth(
    rules: [
      { allow: owner, ownerField: "id", operations: [create, update, read] }
      { allow: groups, groups: ["Admin"] }
    ]
  ) {
  id: ID!
  givenName: String!
  familyName: String!
  email: String! @auth(rules: [{ allow: owner, ownerField: "id" }])
  picture: String
  identityId: String
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
  notes: [PahinaNote]
    @connection(name: "PahinaUserNotes", sortField: "updatedAt")
    @auth(rules: [{ allow: owner, ownerField: "id" }])
  stores: [PahinaUserStore] @connection(name: "PahinaUserStores")
}

type PahinaMainStore
  @model(subscriptions: null, mutations: null)
  @auth(rules: [{ allow: groups, groups: ["Admin"] }]) {
  id: ID!
  digitalPublicationId: String
  digitalLocationId: String
}

type PahinaUserStore
  @model(subscriptions: null, mutations: null)
  @auth(
    rules: [
      { allow: owner, ownerField: "owner", operations: [read] }
      { allow: groups, groups: ["Admin"] }
    ]
  ) {
  id: ID!
  owner: PahinaUser! @connection(name: "PahinaUserStores")
  products: [PahinaUserStoreProduct]
    @connection(name: "PahinaUserStoreProducts")
  skuPrefix: String
}

type PahinaUserStoreProduct
  @model(subscriptions: null, mutations: null)
  @key(fields: ["storeId", "sku"])
  @auth(
    rules: [
      { allow: owner, ownerField: "owner", operations: [read] }
      { allow: groups, groups: ["Admin"] }
    ]
  ) {
  sku: String!
  store: PahinaUserStore!
    @connection(name: "PahinaUserStoreProducts", keyField: "storeId")
  storeId: String!
  shopifyProductId: String
  shopifyShopId: String
  onlineStoreUrl: String
  onlineStorePreviewUrl: String
  handle: String
  status: PahinaStoreProductStatus
  rawResponse: String
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

type PahinaNote
  @model(
    subscriptions: null
    mutations: {
      delete: "deletePahinaNote"
      update: "updatePahinaNote"
      create: "createPahinaNote"
    }
  )
  @auth(
    rules: [
      { allow: owner, ownerField: "author", operations: [create, update, read] }
      { allow: groups, groups: ["Admin"] }
    ]
  ) {
  id: ID!
  author: PahinaUser @connection(name: "PahinaUserNotes")
  case: PahinaCase @connection(name: "PahinaCases")
  promotional: String
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
  status: PahinaNoteStatus
  priceLevel: PahinaPriceLevel
  value: String
}

type PahinaCase
  @model(subscriptions: null)
  @auth(
    rules: [
      { allow: groups, groups: ["Admin"], operations: [update, create, delete] }
    ]
  ) {
  id: ID!
  title: String!
  code: String!
  link: String
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
  date: String
  notes: [PahinaNote] @connection(name: "PahinaCases", sortField: "updatedAt")
}

type Subscription {
  onCreatePahinaCase: PahinaCase @aws_subscribe(mutations: ["createPahinaCase"])
}
